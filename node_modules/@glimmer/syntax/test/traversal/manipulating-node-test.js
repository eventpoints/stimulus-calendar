'use strict';

var _support = require('../support');

var _syntax = require('@glimmer/syntax');

QUnit.module('[glimmer-syntax] Traversal - manipulating');
['enter', 'exit'].forEach(eventName => {
    QUnit.test(`[${eventName}] Replacing self in a key (returning null)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName]: node => {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return null;
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an empty array)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with multiple nodes)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotReplaceNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning null)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return null;
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an empty array)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with multiple nodes)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{b}}{{c}}{{z}}`);
    });
});
QUnit.module('[glimmer-syntax] Traversal - manipulating (edge cases)');
QUnit.test('Inside of a block', () => {
    let ast = (0, _syntax.preprocess)(`{{y}}{{#w}}{{x}}{{y}}{{z}}{{/w}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement(node) {
            if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{a}}{{b}}{{c}}{{#w}}{{x}}{{a}}{{b}}{{c}}{{z}}{{/w}}`);
});
QUnit.test('Should recurrsively walk the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement(node) {
            if (node.path.original === 'x') {
                return _syntax.builders.mustache('y');
            } else if (node.path.original === 'y') {
                return _syntax.builders.mustache('z');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{z}}{{z}}{{z}}`);
});
QUnit.test('Should recurrsively walk the keys in the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{#foo}}{{#bar}}{{baz}}{{/bar}}{{else}}{{#bar}}{{bat}}{{/bar}}{{/foo}}`);
    (0, _syntax.traverse)(ast, {
        BlockStatement(node) {
            if (node.path.original === 'foo') {
                return _syntax.builders.block(_syntax.builders.path('x-foo'), node.params, node.hash, node.program, node.inverse, node.loc);
            } else if (node.path.original === 'bar') {
                return _syntax.builders.block(_syntax.builders.path('x-bar'), node.params, node.hash, node.program, node.inverse, node.loc);
            }
            return;
        },
        MustacheStatement: function (node) {
            if (node.path.original === 'baz') {
                return _syntax.builders.mustache('x-baz');
            } else if (node.path.original === 'bat') {
                return _syntax.builders.mustache('x-bat');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{#x-foo}}{{#x-bar}}{{x-baz}}{{/x-bar}}{{else}}{{#x-bar}}{{x-bat}}{{/x-bar}}{{/x-foo}}`);
});
QUnit.test('Exit event is not triggered if the node is replaced during the enter event', assert => {
    let ast = (0, _syntax.preprocess)(`{{x}}`);
    let entered = [];
    let exited = [];
    (0, _syntax.traverse)(ast, {
        MustacheStatement: {
            enter(node) {
                entered.push(node.path.original);
                return _syntax.builders.mustache('y');
            },
            exit(node) {
                exited.push(node.path.original);
            }
        }
    });
    assert.deepEqual(entered, ['x', 'y']);
    assert.deepEqual(exited, ['y']);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC90ZXN0L3RyYXZlcnNhbC9tYW5pcHVsYXRpbmctbm9kZS10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQTs7QUFTQSxNQUFNLE1BQU4sQ0FBYSwyQ0FBYjtBQUVDLENBQUMsT0FBRCxFQUFVLE1BQVYsRUFBOEMsT0FBOUMsQ0FBc0QsYUFBWTtBQUNqRSxVQUFNLElBQU4sQ0FBVyxJQUFJLFNBQVMsNENBQXhCLEVBQXNFLFVBQVM7QUFDN0UsWUFBSSxNQUFNLHdCQUFNLGVBQU4sQ0FBVjtBQUNBLFlBQUksS0FBSyxJQUFJLElBQUosQ0FBUyxDQUFULENBQVQ7QUFDQSxZQUFJLE9BQU8sR0FBRyxVQUFILENBQWMsQ0FBZCxDQUFYO0FBRUEsZUFBTyxNQUFQLENBQWMsTUFBSztBQUNqQixrQ0FBUyxHQUFULEVBQWM7QUFDWixtQ0FBbUI7QUFDakIscUJBQUMsU0FBRCxHQUFjLElBQUQsSUFBZ0M7QUFDM0MsNEJBQUksS0FBSyxJQUFMLENBQVUsSUFBVixLQUFtQixnQkFBbkIsSUFBdUMsS0FBSyxJQUFMLENBQVUsS0FBVixDQUFnQixDQUFoQixNQUF1QixHQUFsRSxFQUF1RTtBQUNyRSxtQ0FBTyxJQUFQO0FBQ0Q7QUFDRDtBQUNEO0FBTmdCO0FBRFAsYUFBZDtBQVVELFNBWEQsRUFXRyw4QkFBaUIsS0FBSyxLQUF0QixFQUE2QixJQUE3QixFQUFtQyxPQUFuQyxDQVhIO0FBWUQsS0FqQkQ7QUFtQkEsVUFBTSxJQUFOLENBQVcsSUFBSSxTQUFTLHNEQUF4QixFQUFnRixVQUFTO0FBQ3ZGLFlBQUksTUFBTSx3QkFBTSxlQUFOLENBQVY7QUFDQSxZQUFJLEtBQUssSUFBSSxJQUFKLENBQVMsQ0FBVCxDQUFUO0FBQ0EsWUFBSSxPQUFPLEdBQUcsVUFBSCxDQUFjLENBQWQsQ0FBWDtBQUVBLGVBQU8sTUFBUCxDQUFjLE1BQUs7QUFDakIsa0NBQVMsR0FBVCxFQUFjO0FB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cEJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXN0RXF1YWwgfSBmcm9tICcuLi9zdXBwb3J0JztcbmltcG9ydCB7XG4gIHByZXByb2Nlc3MgYXMgcGFyc2UsXG4gIHRyYXZlcnNlLFxuICBidWlsZGVycyBhcyBiLFxuICBBU1QsXG4gIGNhbm5vdFJlbW92ZU5vZGUsXG4gIGNhbm5vdFJlcGxhY2VOb2RlLFxufSBmcm9tICdAZ2xpbW1lci9zeW50YXgnO1xuXG5RVW5pdC5tb2R1bGUoJ1tnbGltbWVyLXN5bnRheF0gVHJhdmVyc2FsIC0gbWFuaXB1bGF0aW5nJyk7XG5cbihbJ2VudGVyJywgJ2V4aXQnXSBhcyBBcnJheTwnZW50ZXInIHwgJ2V4aXQnPikuZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIG51bGwpYCwgYXNzZXJ0ID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICBsZXQgZWwgPSBhc3QuYm9keVswXSBhcyBBU1QuRWxlbWVudE5vZGU7XG4gICAgbGV0IGF0dHIgPSBlbC5hdHRyaWJ1dGVzWzBdO1xuXG4gICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXTogKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9LCBjYW5ub3RSZW1vdmVOb2RlKGF0dHIudmFsdWUsIGF0dHIsICd2YWx1ZScpKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBhbiBlbXB0eSBhcnJheSlgLCBhc3NlcnQgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShgPHggeT17e3p9fSAvPmApO1xuICAgIGxldCBlbCA9IGFzdC5ib2R5WzBdIGFzIEFTVC5FbGVtZW50Tm9kZTtcbiAgICBsZXQgYXR0ciA9IGVsLmF0dHJpYnV0ZXNbMF07XG5cbiAgICBhc3NlcnQudGhyb3dzKCgpID0+IHtcbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSwgY2Fubm90UmVtb3ZlTm9kZShhdHRyLnZhbHVlLCBhdHRyLCAndmFsdWUnKSk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYSBub2RlKWAsICgpID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgnYScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBgPHggeT17e2F9fSAvPmApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KFxuICAgIGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggYSBzaW5nbGUgbm9kZSlgLFxuICAgICgpID0+IHtcbiAgICAgIGxldCBhc3QgPSBwYXJzZShgPHggeT17e3p9fSAvPmApO1xuXG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICByZXR1cm4gW2IubXVzdGFjaGUoJ2EnKV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhc3RFcXVhbChhc3QsIGA8eCB5PXt7YX19IC8+YCk7XG4gICAgfVxuICApO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBtdWx0aXBsZSBub2RlcylgLFxuICAgIGFzc2VydCA9PiB7XG4gICAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICAgIGxldCBlbCA9IGFzdC5ib2R5WzBdIGFzIEFTVC5FbGVtZW50Tm9kZTtcbiAgICAgIGxldCBhdHRyID0gZWwuYXR0cmlidXRlc1swXTtcblxuICAgICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyksIGIubXVzdGFjaGUoJ2InKSwgYi5tdXN0YWNoZSgnYycpXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSwgY2Fubm90UmVwbGFjZU5vZGUoYXR0ci52YWx1ZSwgYXR0ciwgJ3ZhbHVlJykpO1xuICAgIH1cbiAgKTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIG51bGwpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7en19YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gZW1wdHkgYXJyYXkpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e3p9fWApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGEgbm9kZSlgLCAoKSA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgnYScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e2F9fXt7en19YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBhIHNpbmdsZSBub2RlKWAsXG4gICAgKCkgPT4ge1xuICAgICAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICAgICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgICBpZiAobm9kZS5wYXRoLnR5cGUgPT09ICdQYXRoRXhwcmVzc2lvbicgJiYgbm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e2F9fXt7en19YCk7XG4gICAgfVxuICApO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBtdWx0aXBsZSBub2RlcylgLFxuICAgICgpID0+IHtcbiAgICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpLCBiLm11c3RhY2hlKCdiJyksIGIubXVzdGFjaGUoJ2MnKV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7YX19e3tifX17e2N9fXt7en19YCk7XG4gICAgfVxuICApO1xufSk7XG5cblFVbml0Lm1vZHVsZSgnW2dsaW1tZXItc3ludGF4XSBUcmF2ZXJzYWwgLSBtYW5pcHVsYXRpbmcgKGVkZ2UgY2FzZXMpJyk7XG5cblFVbml0LnRlc3QoJ0luc2lkZSBvZiBhIGJsb2NrJywgKCkgPT4ge1xuICBsZXQgYXN0ID0gcGFyc2UoYHt7eX19e3sjd319e3t4fX17e3l9fXt7en19e3svd319YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQobm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpLCBiLm11c3RhY2hlKCdiJyksIGIubXVzdGFjaGUoJ2MnKV07XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSxcbiAgfSk7XG5cbiAgYXN0RXF1YWwoYXN0LCBge3thfX17e2J9fXt7Y319e3sjd319e3t4fX17e2F9fXt7Yn19e3tjfX17e3p9fXt7L3d9fWApO1xufSk7XG5cblFVbml0LnRlc3QoJ1Nob3VsZCByZWN1cnJzaXZlbHkgd2FsayB0aGUgdHJhbnNmb3JtZWQgbm9kZScsICgpID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICB0cmF2ZXJzZShhc3QsIHtcbiAgICBNdXN0YWNoZVN0YXRlbWVudChub2RlKSB7XG4gICAgICBpZiAobm9kZS5wYXRoLm9yaWdpbmFsID09PSAneCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3knKTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZS5wYXRoLm9yaWdpbmFsID09PSAneScpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3onKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9LFxuICB9KTtcblxuICBhc3RFcXVhbChhc3QsIGB7e3p9fXt7en19e3t6fX1gKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdTaG91bGQgcmVjdXJyc2l2ZWx5IHdhbGsgdGhlIGtleXMgaW4gdGhlIHRyYW5zZm9ybWVkIG5vZGUnLCAoKSA9PiB7XG4gIGxldCBhc3QgPSBwYXJzZShge3sjZm9vfX17eyNiYXJ9fXt7YmF6fX17ey9iYXJ9fXt7ZWxzZX19e3sjYmFyfX17e2JhdH19e3svYmFyfX17ey9mb299fWApO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIEJsb2NrU3RhdGVtZW50KG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICdmb28nKSB7XG4gICAgICAgIHJldHVybiBiLmJsb2NrKFxuICAgICAgICAgIGIucGF0aCgneC1mb28nKSxcbiAgICAgICAgICBub2RlLnBhcmFtcyxcbiAgICAgICAgICBub2RlLmhhc2gsXG4gICAgICAgICAgbm9kZS5wcm9ncmFtLFxuICAgICAgICAgIG5vZGUuaW52ZXJzZSxcbiAgICAgICAgICBub2RlLmxvY1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICdiYXInKSB7XG4gICAgICAgIHJldHVybiBiLmJsb2NrKFxuICAgICAgICAgIGIucGF0aCgneC1iYXInKSxcbiAgICAgICAgICBub2RlLnBhcmFtcyxcbiAgICAgICAgICBub2RlLmhhc2gsXG4gICAgICAgICAgbm9kZS5wcm9ncmFtLFxuICAgICAgICAgIG5vZGUuaW52ZXJzZSxcbiAgICAgICAgICBub2RlLmxvY1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH0sXG5cbiAgICBNdXN0YWNoZVN0YXRlbWVudDogZnVuY3Rpb24obm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JheicpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF6Jyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JhdCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF0Jyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSxcbiAgfSk7XG5cbiAgYXN0RXF1YWwoXG4gICAgYXN0LFxuICAgIGB7eyN4LWZvb319e3sjeC1iYXJ9fXt7eC1iYXp9fXt7L3gtYmFyfX17e2Vsc2V9fXt7I3gtYmFyfX17e3gtYmF0fX17ey94LWJhcn19e3sveC1mb299fWBcbiAgKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdFeGl0IGV2ZW50IGlzIG5vdCB0cmlnZ2VyZWQgaWYgdGhlIG5vZGUgaXMgcmVwbGFjZWQgZHVyaW5nIHRoZSBlbnRlciBldmVudCcsIGFzc2VydCA9PiB7XG4gIGxldCBhc3QgPSBwYXJzZShge3t4fX1gKTtcblxuICBsZXQgZW50ZXJlZDogQXJyYXk8c3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWQ+ID0gW107XG4gIGxldCBleGl0ZWQ6IEFycmF5PHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkPiA9IFtdO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICBlbnRlcihub2RlKSB7XG4gICAgICAgIGVudGVyZWQucHVzaChub2RlLnBhdGgub3JpZ2luYWwpO1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneScpO1xuICAgICAgfSxcbiAgICAgIGV4aXQobm9kZSkge1xuICAgICAgICBleGl0ZWQucHVzaChub2RlLnBhdGgub3JpZ2luYWwpO1xuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhc3NlcnQuZGVlcEVxdWFsKGVudGVyZWQsIFsneCcsICd5J10pO1xuICBhc3NlcnQuZGVlcEVxdWFsKGV4aXRlZCwgWyd5J10pO1xufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9